const cache={},data={title:null,basePrice:null,stock:null,status:null,option:null,current_set:null,difference:null},txt={productAvailable:"Produkt dostępny",productNotAvailable:"Produkt niedostępny",max:"Maksymalny ilość produktu to:",min:"Liczba nie może być równa lub mniejsza niż zero"},btn=document.querySelector(".btn"),modal=document.querySelector(".modal"),close=document.querySelector(".close"),close_mobile=document.querySelector(".close-mobile"),product_box=document.querySelector(".product-box"),titleOnPage=document.querySelector(".title"),photo_box=document.querySelector(".photo-box"),sizeContainer=document.querySelector(".size-container"),price=document.querySelector(".price"),options=document.querySelector(".options"),available=document.querySelector(".available"),icon=document.querySelector(".icon-available"),counter_input=document.querySelector(".input-counter"),button_submit=document.querySelector(".submit"),delivery_box=document.querySelector(".delivery-box"),previous_photo=document.querySelector(".fa-angle-left"),next_photo=document.querySelector(".fa-angle-right"),increase=document.querySelector(".plus"),decrease=document.querySelector(".minus"),form=document.querySelector("form"),fetchData=async e=>{const t=await fetch(e);return await t.json()},getData=async()=>{cache.title=await fetchData("https://my-json-server.typicode.com/lumio12r/modal-new/product"),cache.sizes=await fetchData("https://my-json-server.typicode.com/lumio12r/modal-new/sizes"),cache.multiversions=await fetchData("https://my-json-server.typicode.com/lumio12r/modal-new/multiversions")},createTitle=async()=>{data.title=cache.title.name,titleOnPage.innerText=data.title},createButtons=async()=>{const e=Object.values(cache.sizes.items);for(const[t,a]of e.entries()){let e=document.createElement("button");e.innerText=a.name,0===t&&e.classList.add("active"),e.classList.add("size-button"),e.setAttribute("type","button"),e.setAttribute("id",a.type),sizeContainer.appendChild(e)}},getPrice=async()=>{const e=document.querySelector(".active");data.basePrice=cache.sizes.items[e.id].price,price.innerText=data.basePrice+".00 zł"},newTitle=async()=>{const e=document.querySelector(".active");data.option=e.innerText.slice(4).replace(/\s/g,"");let t=data.title.slice(29,-10);data.title=data.title.replace(t,data.option),titleOnPage.innerText=data.title},checkStock=async()=>{const e=document.querySelector(".active");data.stock=cache.sizes.items[e.id].amount},setStatus=async()=>{0===data.stock?(data.status=txt.productNotAvailable,icon.removeAttribute("src"),icon.setAttribute("src","./resources/icons/close.svg"),available.innerText=data.status,button_submit.disabled=!0,counter_input.disabled=!0,counter_input.value=0,increase.disabled=!0,decrease.disabled=!0,available.style.width="125px",increase.classList.add("disabled"),decrease.classList.add("disabled"),counter_input.classList.add("disabled"),delivery_box.classList.remove("no-visible","visible-flex"),delivery_box.classList.add("no-visible")):(icon.setAttribute("src","./resources/icons/ok.svg"),data.status=txt.productAvailable,available.innerText=data.status,button_submit.disabled=!1,counter_input.disabled=!1,counter_input.value=1,increase.disabled=!1,decrease.disabled=!1,increase.classList.remove("disabled"),decrease.classList.remove("disabled"),counter_input.classList.remove("disabled"),delivery_box.classList.remove("no-visible","visible-flex"),delivery_box.classList.add("visible-flex"))},createSetsImages=async()=>{for(let e of cache.multiversions){let t=Object.values(e.items);for(let[e,a]of t.entries()){let t=Object.values(a.products),s=document.createElement("div");s.classList.add("set"),0===e&&(s.classList.add("current-set"),data.current_set=s);for(let e of t){let t=Object.values(e.images);for(let[e,a]of t.entries()){let t=document.createElement("img");t.setAttribute("src",a.url),t.setAttribute("alt",a.alt),t.classList.add("photo"),0===e&&t.classList.add("current-photo"),s.appendChild(t)}photo_box.appendChild(s)}}}},createOptions=async()=>{for(let e of cache.multiversions){let t=Object.values(e.items);for(let e of t){let t=e.values_id,a=e.values[t].name,s=document.createElement("option");s.innerText=a,s.setAttribute("value",t),options.appendChild(s)}}},priceDifference=async e=>{for(let t of cache.multiversions){let a=Object.values(t.items);for(let t of a){let a=t.values_id,s=Object.values(t.products);for(let t of s)if(a==e.value)if(data.difference=parseFloat(t.price_difference),0===data.difference)price.innerText=data.basePrice+".00 zł";else{let e=data.basePrice+data.difference;price.innerText=e+".00 zł"}}}},changeGallery=async e=>{let t,a=document.querySelector(".current-set"),s=document.querySelectorAll(".set");switch(console.log(e),e.value){case"61":t=0;break;case"60":t=1;break;case"59":t=2}a.classList.remove("current-set"),data.current_set=s[t],data.current_set.classList.add("current-set")},createModal=async()=>{await getData(),await createTitle(),createButtons(),getPrice(),await newTitle(),await checkStock(),await setStatus(),await createSetsImages(),await createOptions(),console.log(cache)};createModal(),btn.addEventListener("click",()=>{modal.classList.contains("no-visible")&&(modal.classList.remove("no-visible"),modal.classList.add("visible")),counter_input.value=1}),counter_input.addEventListener("input",()=>{checkStock(),counter_input.value>data.stock&&(alert(txt.max+" "+data.stock),counter_input.value=data.stock),counter_input.value<1&&alert(txt.min)}),sizeContainer.addEventListener("click",e=>{let t=document.querySelector(".active");t===e.target||(t.classList.remove("active"),e.target.classList.add("active"),getPrice(),newTitle(),checkStock(),setStatus(),options[0].selected=!0,data.current_set.classList.remove("current-set"),photo_box.children[0].classList.add("current-set"))}),previous_photo.addEventListener("click",()=>{let e=data.current_set.querySelector(".current-photo");e.classList.remove("current-photo"),null===e.previousSibling&&data.current_set.lastChild.classList.add("current-photo"),e.previousSibling.classList.add("current-photo")}),next_photo.addEventListener("click",()=>{let e=data.current_set.querySelector(".current-photo");e.classList.remove("current-photo");try{e.nextSibling.classList.add("current-photo")}catch(e){data.current_set.firstChild.classList.add("current-photo")}}),close.onclick=(()=>{modal.classList.add("no-visible")}),close_mobile.onclick=(()=>{modal.classList.add("no-visible")}),window.onclick=(e=>{modal.classList.contains("visible")&&e.target==modal&&(modal.classList.remove("visible"),modal.classList.add("no-visible"))}),form.addEventListener("submit",e=>{e.preventDefault();let t=document.querySelector(".active");modal.classList.add("no-visible"),alert(`Twoj produkt ${data.title} w cenie ${data.basePrice-data.difference}.00 zł za sztukę w ilości ${counter_input.value} została dodana do Twojego koszyka`),t.classList.remove("active"),sizeContainer.firstChild.classList.add("active"),options[0].selected=!0,data.current_set.classList.remove("current-set"),photo_box.children[0].classList.add("current-set"),getPrice()}),options.addEventListener("change",e=>{priceDifference(e.target),changeGallery(e.target)}),increase.addEventListener("click",()=>{checkStock(),counter_input.value==data.stock?(alert(txt.max+" "+data.stock),counter_input.value=data.stock):counter_input.value++}),decrease.addEventListener("click",()=>{counter_input.value<=1?alert(txt.min):--counter_input.value});
